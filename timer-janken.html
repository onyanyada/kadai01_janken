<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="js/jquery-2.1.3.min.js"></script>
    <link rel="stylesheet" href="css/sample.css">
    <title>タイマーじゃんけん</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.2/dist/confetti.browser.min.js"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>


</head>

<body>

    <header>
        <h1>タイマーじゃんけん</h1>
    </header>

    <main>
    <div class="timer">
        <div>時間を決めてじゃんけんする</div>
        <input id="sec" type="text">
        <button id="start">開始</button>
        
        <div id="time"></div>
    </div>

     <div class="jankenGame">
    <div id="janken">
        <ul>
            <li id="gu_btn" class="option">グー</li>
            <li id="cho_btn" class="option">チョキ</li>
            <li id="par_btn" class="option">パー</li>
        </ul>
        <div>コンピュータの出した手は？なに？</div>
        <div><span id="pc_hands"></span></div>
        <div id="result-list">
            <div id="judgment">勝ちor負けorあいこ</div>
            <div id="score"></div>
            <div class="total inner-result"></div>
            <div class="total outer-result"></div>
        </div>
    </div>
    <p class="total outer-result"></p>
    <div class="chart">
        <div id="chart_div"></div>
    </div>
    </div>
    <div>
        <button><a href="./3s-janken.html">３秒じゃんけんもやってみる</a></button>
    </div>
    </main>

    <footer></footer>
    <script>
    // タイマー
    const time= document.querySelector("#time");
    const sec = document.querySelector("#sec");
    let count = 0;

    $('#start').click(function(){

    const set_id = setInterval(function(){
            count++;
            time.innerHTML=count;
            if(count == sec.value){
                $("#janken").hide();
                $('.inner-result').hide();
                $('.outer-result').show();
                clearInterval(set_id);
            }

        },1000);

    });




   
    // 勝敗合計点数
    let total = 0; 
    let hand = "";//変数用意
    let judge = ""; //変数用意
    let score; //変数用意
    

    // グーを選んだ時
    $("#gu_btn").on("click",function(){
    const r =Math.ceil(Math.random()*3);//1.乱数(1~3)
    

    //2.if分岐処理

    if(r==1){
        hand = '<img src="./img/gu.png" width="270px">';
        judge = 'あいこ';
        score = 0;
        
    }
    if(r==2){
        hand = '<img src="./img/choki.png" width="300px">';
        judge = '勝ち';
        score = 1;
    confetti({
	       particleCount: 100,
	       spread: 70,
	       origin: { y: 0.6 }
	     });
    }
    if(r==3){
        hand = '<img src="./img/pa.png" width="300px">';
        judge = '負け';
        score = -1;
    }


    total += score;

    //3.表示処理
    $("#pc_hands").html(hand);
    $("#judgment").html(judge);
    $("#score").html(score);
    $(".total").text(total);

    updateChart(total);

    });

    // チョキを選んだ時
    $("#cho_btn").on("click",function(){
    const r =Math.ceil(Math.random()*3);//1.乱数(1~3)

    //2.if分岐処理
    if(r==1){
        hand = '<img src="./img/gu.png" width="270px">';
        judge = '負け';
        score = -1;
    }
    if(r==2){
        hand = '<img src="./img/choki.png" width="300px">';
        judge = 'あいこ';
        score = 0;
    }
    if(r==3){
        hand = '<img src="./img/pa.png" width="300px">';
        judge = '勝ち';
        score = 1;

        confetti({
	       particleCount: 100,
	       spread: 70,
	       origin: { y: 0.6 }
	     });

    }

    total += score;

    //3.表示処理
    $("#pc_hands").html(hand);
    $("#judgment").html(judge);
    $("#score").html(score);
    $(".total").text(total);

    updateChart(total);
    
    });
   
    // パーを選んだ時
    $("#par_btn").on("click",function(){
    const r =Math.ceil(Math.random()*3);//1.乱数(1~3)
    //2.if分岐処理
    if(r==1){
        hand = '<img src="./img/gu.png" width="270px">';
        judge = '勝ち';
        score = 1;

        confetti({
	       particleCount: 100,
	       spread: 70,
	       origin: { y: 0.6 }
	     });
    }
    if(r==2){
        hand = '<img src="./img/choki.png" width="300px">';
        judge = '負け';
        score = -1;
    }
    if(r==3){
        hand = '<img src="./img/pa.png" width="300px">';
        judge = 'あいこ';
        score = 0;
    }
    total += score;
    
    //3.表示処理
    $("#pc_hands").html(hand);
    $("#judgment").html(judge);
    $("#score").html(score);
    $(".total").text(total);

    updateChart(total);
    });

// Google Charts ライブラリを読み込む
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(initChart);

let chart;
let data;
let options;
let counts = 0; // 回数カウント用変数

// グラフの初期化
function initChart() {
    data = google.visualization.arrayToDataTable([
        ['Count', 'Total Score'],
        [0, 0]
    ]);

    options = {
        title: 'Janken Total Score',
        curveType: 'function',
        legend: { position: 'bottom' },
        hAxis: {
            title: 'Count'
        },
        vAxis: {
            title: 'Total Score'
        }
    };

    chart = new google.visualization.LineChart(document.getElementById('chart_div'));

    chart.draw(data, options);
}

// グラフの更新
function updateChart(total) {
    counts++;
    data.addRow([counts, total]);
    chart.draw(data, options);
}


   
</script>
</body>

</html>